#!/usr/bin/env bash
#
# https://github.com/sandorex/config
# sets the layout for the monitors
#
# requires rofi

# use `kscreen-doctor -o` to find names for these
DELL="output.HDMI-A-1" # HDMI
ASUS="output.DP-1"     # VGA
# TV=""                  # DVI

choose() {
    printf '%s\n' "$@" | rofi -dmenu -normal-window -steal-focus -p "${1:?}" -format 'i'
}

# TODO rework so that each monitor has array for arguments for each mode, then
# set to empty if the monitor/output is not connected
dell_common=(
    "$DELL".enable
    "$DELL".priority.1
    "$DELL".mode.0
)

asus_common=(
    "$ASUS".enable
    "$ASUS".priority.2
    "$ASUS".mode.0
    "$ASUS.position.0,0"
)

# modes
# 1-3: 1080p60
# 11: 768p60
# 13: 720p60
# all of them look like garbage
#
# overscan is only needed if the tv is connected over HDMI for some reason..
# tv_common=(
#     "$TV".enable
#     "$TV".priority.3
#     "$TV".mode.0
#     "$TV".overscan.0
# )

LAYOUTS=( 'single' 'dual-lvert' 'dual-lvert-rtv' 'dual' 'dual-rtv' 'tv' )

layout_single() {
    kscreen-doctor \
        "${dell_common[@]}" \
        "$DELL".position.0,0 \
        "$ASUS".disable
        # "$TV".disable
}

layout_dual-lvert() {
    kscreen-doctor \
        "${dell_common[@]}" \
        "$DELL".position.1080,420 \
        "${asus_common[@]}" \
        "$ASUS".rotation.left
        # "$TV".disable
}

layout_dual() {
    kscreen-doctor \
        "${dell_common[@]}" \
        "$DELL".position.1920,0 \
        "${asus_common[@]}" \
        "$ASUS".rotation.normal
        # "$TV".disable
}

layout_dual-lvert-rtv() {
    kscreen-doctor \
        "${dell_common[@]}" \
        "$DELL".position.1080,420 \
        "${asus_common[@]}" \
        "$ASUS".rotation.left
        # "${tv_common[@]}" \
        # "$TV".position.3000,420
    # TODO note this is for 1080p and im not sure the tv is 1080p
}

layout_dual-rtv() {
    kscreen-doctor \
        "${dell_common[@]}" \
        "$DELL".position.1920,0 \
        "${asus_common[@]}" \
        "$ASUS".rotation.normal
        # "${tv_common[@]}" \
        # "$TV".position.3840,0
    # TODO note this is for 1080p and im not sure the tv is 1080p
}

layout_tv() {
    kscreen-doctor \
        "$DELL".disable \
        "$ASUS".disable
        # "${tv_common[@]}" \
        # "$TV".position.0,0
}

case "$1" in
    default)
        # default to layout 0
        "layout_${LAYOUTS[0]}"
        ;;
    '') # empty
        if ! index=$(choose "${LAYOUTS[@]}"); then
            echo "Cancelled"
            exit 1
        fi

        "layout_${LAYOUTS[$index]}"
        ;;
    *)
        if ! type -t "layout_$1" &>/dev/null; then
            echo "Invalid layout '$1'"
            exit 1
        fi

        "layout_$1"
        ;;
esac

