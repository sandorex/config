#!/bin/bash
#
# mtime - gets mtime of any file or dir

POSITIONAL_ARGS=()

while [[ $# -gt 0 ]]; do
    case $1 in
        -h)
            HELP=1
            shift
            ;;
        -*|--*)
            echo "Unknown option $1"
            exit 1
            ;;
        *)
            # save positional arg
            POSITIONAL_ARGS+=("$1")
            shift
            ;;
    esac
done

# restore positional parameters
set -- "${POSITIONAL_ARGS[@]}"

if [[ -z "$1" || -n "$HELP" ]]; then
    cat << EOF
Usage: $0 [-h] <path>

Gets mtime of path, in case of a directory it prints mtime of latest modified file
EOF
    exit 0
fi

if [[ ! -e "$1" && ! -L "$1" ]]; then
    echo "Path does not exist '$1'" >/dev/stderr
    exit 1
fi

if [[ -d "$1" ]]; then
    find "$1" -not -type -exec stat \{} --printf="%Y\n" \; | sort -n -r | head -n 1
else
    stat --printf "%Y" "$1"
fi
