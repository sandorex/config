#!/usr/bin/env bash
#
# audio-switcher - script that sets/toggles headphones or speakers using pactl
#
# the script works on piperwire, written for debian 12

set -e

# get these using `pactl list sinks` in ports section, motherboard dependant
HEADPHONES='analog-output-headphones'
SPEAKERS='analog-output-lineout'

# get this using `pactl get-default-sink`
SINK='alsa_output.pci-0000_09_00.6.analog-stereo'

set-sink() { pactl set-default-sink "$1"; }
set-port() { pactl set-sink-port 0 "$1"; }
is-active-port() { pactl list sinks | grep "Active Port: $1" &>/dev/null; }

active_sink="$(pactl get-default-sink)"

# explicitly sets output so change the sink if not correct
case "$1" in
    h|headphones)
        [[ "$active_sink" != "$SINK" ]] && set-sink "$SINK"
        set-port "$HEADPHONES"
        ;;
    s|speakers)
        [[ "$active_sink" != "$SINK" ]] && set-sink "$SINK"
        set-port "$SPEAKERS"
        ;;
    t|toggle|'') # empty argument defaults to toggle as well
        # if active sink is not the correct one just give up
        if [[ "$active_sink" != "$SINK" ]]; then
            echo "Unknown sink is selected, quitting.."
            exit 1
        fi

        # toggle between speakers and headphones
        if is-active-port "$HEADPHONES"; then
            set-port "$SPEAKERS"
        elif is-active-port "$SPEAKERS"; then
            set-port "$HEADPHONES"
        else
            set-port "$SPEAKERS"
            echo "Invalid port was set defaulted to speakers"
        fi
        ;;
    *)
        echo "Invalid argument '$1'"
        exit 1
        ;;
    esac

