#!/usr/bin/env bash
#
# task/log - log to current task

DIR="$HOME/.task"
DATEFMT="%d-%m-%Y %H:%M"
TAG='STATUS'

POSITIONAL_ARGS=()

while [ $# -gt 0 ]; do
    case $1 in
        -p|--problem)
            TAG='PROBLEM'
            shift
            ;;
        -*)
            echo "Unknown option $1"
            exit 1
            ;;
        *)
            # save positional arg
            POSITIONAL_ARGS+=("$1")
            shift
            ;;
    esac
done

# restore positional parameters
set -- "${POSITIONAL_ARGS[@]}"

# do not write anything if it does not exist
[[ ! -e "$DIR/.current.md" ]] && exit 1

# add the heading
echo >> "$DIR/.current.md"
echo "## ${TAG} $(date "+$DATEFMT")" >> "$DIR/.current.md"

if [[ -z "$*" ]]; then
    command "$EDITOR" "$DIR/$(readlink "$DIR/.current.md")"
else
    echo "$*" >> "$DIR/.current.md"
fi

